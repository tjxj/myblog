å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å­œå­œä¸å€¦å­¦ä¹ çš„Zhangbeihaiã€‚
---
author: "è€ç« mlpy"
title: "åœ¨å®‰å“æ‰‹æœºéƒ¨ç½²æœºå™¨å­¦ä¹ åº”ç”¨"
date: 2022-12-16T12:00:06+09:00
description: "ä½†æ˜¯ä½œä¸ºä¸€ä¸ªå¯¹å®‰å“å¼€å‘ä¸€æ— æ‰€çŸ¥çš„äººï¼Œæˆ‘ä¹Ÿæƒ³å°è¯•å€ŸåŠ© TensorFlow Lite åœ¨ Android å’Œ iOS ä¸Šéƒ¨ç½²å¹¶ä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚Learn by doingæ˜¯æˆ‘æœ€æ¨å´‡çš„å­¦ä¹ æ–¹æ³•ï¼Œæ‰€ä»¥å°±è·Ÿç€è¯¾ç¨‹ç¬¬äºŒç« å’Œç¬¬ä¸‰ç« codeäº†ä¸€ä¸‹ï¼Œæ”¶è·æ»¡æ»¡ï¼Œæœ¬æ–‡å³ä¸ºæˆ‘åšçš„å­¦ä¹ ç¬”è®°ã€‚"
draft: false
hideToc: false
enableToc: true
enableTocContent: false
author: è€ç« mlpy
authorEmoji: ğŸ‘¨â€ğŸ’»
tags: 
- AIGC
- OpenAI
- ChatGPT
image: ![](https://files.mdnice.com/user/3611/93300ea3-1fe8-4b0d-8d36-c5a5d80957a4.png)
---

## 0
ä¸Šæœˆåº•æˆ‘ç»„ç»‡äº†[ã€ç»„é˜Ÿå­¦ä¹ ã€‘TensorFlow å…¥é—¨è¯¾ç¨‹ï¼ˆä¸­æ–‡ï¼‰](https://mp.weixin.qq.com/s?__biz=MzA4MjYwMTc5Nw==&mid=2648973550&idx=1&sn=ef37daf07f7b918bbacb65f674f947fb&chksm=8793b2c4b0e43bd217bf415f491191bac0ad94c562cd612086cb2a1e98b4cc8bc756822cda26&token=668859403&lang=zh_CN#rd)
ï¼Œæˆªè‡³ç›®å‰æœ‰300å¤šåŒå­¦åŠ å…¥ã€‚

å­¦ä¹ å†…å®¹æ˜¯

- TensorFlow éƒ¨ç½²ç®€ä»‹  
- TensorFlow Liteç®€ä»‹  
- åœ¨ Android app ä½¿ç”¨TensorFlow Lite
- åœ¨ iOS app ä½¿ç”¨TensorFlow Lite
- ä½¿ç”¨TensorFlow Serving éƒ¨ç½²


 ä¸»è¦å°±æ˜¯ `TensorFlow Lite`ã€`TensorFlow.js` å’Œ `TF Serving`çš„å®æ“ï¼Œå…¶å®ä»Šå¹´3æœˆä»½æˆ‘å°±æ¥è§¦ `TensorFlow.js` äº†ï¼Œå½“æ—¶è¿˜å†™äº†ä¸€ç¯‡å…¥é—¨æ•™ç¨‹ï¼š[TensorFlow.js ç”¨æµè§ˆå™¨ç©æœºå™¨å­¦ä¹ ](https://mp.weixin.qq.com/s?__biz=MzA4MjYwMTc5Nw==&amp;mid=2648964975&amp;idx=3&amp;sn=b04f17ee5633463265debe345946c248&amp;chksm=87946d45b0e3e45312a2912a0e60c8c506569d87a940996cf374867cf36998d798878f166af6&token=66724328&lang=zh_CN#rd)ï¼Œ9æœˆåœ¨è°·æ­Œå¼€å‘è€…å¤§ä¼šä¸Šï¼Œæˆ‘è¿˜äº²èº«ä½“éªŒäº†è¿™äº›[é»‘ç§‘æŠ€](https://mp.weixin.qq.com/s?__biz=MzA4MjYwMTc5Nw==&amp;mid=2648970354&amp;idx=1&amp;sn=e50b3c6fb5bc92371a5b01c1d3c8de1b&amp;chksm=87938658b0e40f4e7a27e4ecf2a3f4df0e5d5264d7f5562fe38b523b5a66af9670cc7732e603&token=66724328&lang=zh_CN#rd)ï¼Œéå¸¸å¥‡å¦™ã€‚

ä½†æ˜¯ä½œä¸ºä¸€ä¸ªå¯¹å®‰å“å¼€å‘ä¸€æ— æ‰€çŸ¥çš„äººï¼Œæˆ‘ä¹Ÿæƒ³å°è¯•å€ŸåŠ© TensorFlow Lite åœ¨ Android å’Œ iOS ä¸Šéƒ¨ç½²å¹¶ä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚Learn by doingæ˜¯æˆ‘æœ€æ¨å´‡çš„å­¦ä¹ æ–¹æ³•ï¼Œæ‰€ä»¥å°±è·Ÿç€è¯¾ç¨‹ç¬¬äºŒç« å’Œç¬¬ä¸‰ç« codeäº†ä¸€ä¸‹ï¼Œæ”¶è·æ»¡æ»¡ï¼Œæœ¬æ–‡å³ä¸ºæˆ‘åšçš„å­¦ä¹ ç¬”è®°ã€‚


## TensorFlow Lite ç®€ä»‹
TensorFlow Lite æ˜¯ä¸€ç§åœ¨è®¾å¤‡ç«¯è¿è¡Œ TensorFlow æ¨¡å‹çš„å¼€æºæ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚ç§»åŠ¨å¼€å‘è¦æ±‚è½»é‡ã€ä½å»¶è¿Ÿã€é«˜æ•ˆã€éšç§ä¿æŠ¤ã€çœç”µï¼ŒLiteå¾ˆå¥½æ»¡è¶³äº†ä»¥ä¸Šè¦æ±‚ã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205155733.png)
![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205160007.png)


TensorFlow Lite å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œæœ€æ ¸å¿ƒçš„æ˜¯è½¬åŒ–å¹¶ä¿å­˜æ¨¡å‹ã€åŠ è½½TFLiteæ¨¡å‹å¹¶é…ç½®å¼ é‡ã€‚
![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205160215.png)

### è®­ç»ƒã€ä¿å­˜TFæ¨¡å‹

è¿™ä¸€æ­¥å†ç»†åˆ†ä¸º5å°æ­¥ï¼Œåˆ†åˆ«æ˜¯ï¼Œè·å–æ•°æ®ã€è·å–åŸºç¡€æ¨¡å‹ã€æ„å»ºæ¨¡å‹ã€è®­ç»ƒæ¨¡å‹ã€ä¿å­˜æ¨¡å‹ã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205161853.png)


åŸºç¡€æ¨¡å‹å¯ä»¥ç›´æ¥å» TensorFlow Hub è·å–

![https://hub.tensorflow.google.cn/](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205162144.png)

å¯ä»¥åœ¨é¡µé¢å·¦ä¾§é€‰æ‹©æƒ³è¦çš„æ¨¡å‹ç±»åˆ«ã€æ ¼å¼ã€TFç‰ˆæœ¬ã€æ˜¯å¦æ”¯æŒå¾®è°ƒç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æœç´¢ã€‚


æ¯”å¦‚å›¾åƒåˆ†ç±»ï¼Œå¯ä»¥ä½¿ç”¨mobilenet_v2è¿™ä¸ªæ¨¡å‹ï¼Œç‚¹å‡»ä¸‹è½½å³å¯ã€‚
ä¹Ÿå¯ä»¥å¤åˆ¶é“¾æ¥ï¼Œé€šè¿‡hub.KerasLayeræ–¹æ³•ä¸‹è½½ã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205162535.png)


å‰©ä¸‹çš„æ­¥éª¤å¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œè®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œç”¨tf.saved_model.saveæ–¹æ³•ä¿å­˜æ¨¡å‹å³å¯ï¼Œæ¨èSavedModelæ ¼å¼ã€‚

### åŠ è½½TFLiteæ¨¡å‹å¹¶é…ç½®å¼ é‡
è¿™ä¸€æ­¥ç»†åˆ†ä¸º3å°æ­¥
![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205163338.png)

å°†æ¨¡å‹æ ¼å¼è½¬æ¢TFLiteæ ¼å¼ï¼Œè½¬åŒ–å¯ä»¥ä½¿ç”¨TFLiteConverteræ–¹æ³•ï¼Œä¿å­˜å°±æ˜¯æ™®é€šçš„æ–‡ä»¶å†™å…¥æ“ä½œï¼Œæ³¨æ„æ ¼å¼æ˜¯.tfliteã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205163521.png)

åŠ è½½TFLiteå¹¶é…ç½®å¼ é‡ä¹Ÿéå¸¸ç®€å•ï¼Œä½¿ç”¨Interpreteræ–¹æ³•å°±è¡Œäº†ã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205163715.png)

æ­£å¼é¡¹ç›®ä¸­ä½¿ç”¨æµ‹è¯•é›†è¿›è¡Œæµ‹è¯•ä¹Ÿæ˜¯å¿…é¡»çš„ï¼ŒæŸ¥çœ‹å‡†ç¡®ç‡ç­‰è¯„ä»·æŒ‡æ ‡æ˜¯å¦è¿˜åœ¨æ¥å—èŒƒå›´å†…ã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205164735.png)

TFLiteè¿˜æä¾›äº†æ¨¡å‹ä¼˜åŒ–æ–¹æ³•converter.optimizations,å¯ä»¥ä½¿æ¨¡å‹æ›´å°å·§ã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205165003.png)


## TFLite Model Maker

å€ŸåŠ© TensorFlow Lite Model Maker åº“ï¼Œå¯ä»¥ç®€åŒ–ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®é›†è®­ç»ƒ TensorFlow Lite æ¨¡å‹çš„è¿‡ç¨‹ã€‚è¯¥åº“ä½¿ç”¨è¿ç§»å­¦ä¹ æ¥å‡å°‘æ‰€éœ€çš„è®­ç»ƒæ•°æ®é‡å¹¶ç¼©çŸ­è®­ç»ƒæ—¶é—´ã€‚ç›®å‰æ”¯æŒå›¾åƒåˆ†ç±»ã€æ–‡å­—åˆ†ç±»ã€éŸ³é¢‘ã€BERTé—®ç­”ç­‰ä»»åŠ¡ã€‚
ä½¿ç”¨å¾ˆç®€å•ï¼Œå…ˆå®‰è£…
```
pip install tflite-model-maker
```

å€ŸåŠ© Model Makerï¼Œä»…ä»…é€šè¿‡å‡ è¡Œä»£ç å³å¯ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®é›†è®­ç»ƒ TensorFlow Lite æ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å°±æ˜¯è®­ç»ƒå›¾åƒåˆ†ç±»æ¨¡å‹çš„æ­¥éª¤ã€‚

```
data = ImageClassifierDataLoader.from_folder('flower_photos/')
train_data, test_data = data.split(0.9)
model = image_classifier.create(train_data)
loss, accuracy = model.evaluate(test_data)
model.export(export_dir='/tmp/')
```

TFLite Model Maker ç»™äº†æˆ‘ä»¬æ›´å¤šçš„æ¨¡å‹åˆ›å»ºçš„å¯é€‰é¡¹ã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205165714.png)


## å®è·µ:ä½¿ç”¨Android Studio å¼€å‘ä¸€ä¸ªTFLiteæ¨¡å‹çš„å¾®å‹APP
å…ˆå®‰è£…Android Studio ï¼Œå®ƒæ˜¯è°·æ­Œæ¨å‡ºçš„ä¸€ä¸ªAndroidé›†æˆå¼€å‘å·¥å…·ï¼ŒåŸºäºIntelliJ IDEA. ç±»ä¼¼ Eclipse ADTï¼ŒAndroid Studio æä¾›äº†é›†æˆçš„ Android å¼€å‘å·¥å…·ç”¨äºå¼€å‘å’Œè°ƒè¯•ã€‚

ä¸‹è½½åœ°å€ï¼š
https://developer.android.google.cn/studio

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205150019.png)

å¦å¤–æˆ‘ä»¬è¿˜èƒ½é¡ºæ‰‹ä»0å¼€å§‹æ¥è§¦ä¸€ä¸‹Kotlinï¼Œè¿™æ˜¯è°·æ­Œæ¨èä½¿ç”¨çš„Andriod Appå¼€å‘è¯­è¨€ã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205171744.png)
### 1

å…ˆç†Ÿæ‚‰ä¸€ä¸‹æµç¨‹ï¼ŒNewä¸€ä¸ªProjectï¼Œé€‰Empty Activity
![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205170953.png)

é¡¹ç›®é…ç½®é¡µåªé‡å‘½åé¡¹ç›®åç§°å³å¯ï¼Œå…¶ä»–ä¸ç”¨ç®¡ï¼Œç­‰å¾…åˆå§‹åŒ–å®Œæˆå³å¯ã€‚

### 2

ç¼–å†™å¸ƒå±€ï¼Œæˆ‘ä»¬çš„é‡ç‚¹ä¸æ˜¯ç•Œé¢è®¾è®¡å’Œå®ç°ï¼Œäº†è§£æµç¨‹å³å¯ã€‚ä¸è¿‡åæœŸä¹Ÿå¯ä»¥å­¦ä¹ ä¸€ä¸‹Androidç•Œé¢å¸ƒå±€åŸºç¡€çŸ¥è¯†ã€‚

### 3
æœ€æ ¸å¿ƒçš„æ˜¯æ·»åŠ TFLiteä¾èµ–è¿™ä¸€æ­¥ï¼Œå› ä¸ºTFLiteä¸æ˜¯Androidè‡ªå¸¦çš„APIï¼Œéœ€è¦ä½¿ç”¨Gradleæ„å»ºå·¥å…·å¼•å…¥TensorFlow Liteå¤–éƒ¨é“¾æ¥åº“ã€‚æ³¨æ„ï¼ŒAndroidå·¥ç¨‹ä¸­æœ‰ä¸¤ä¸ªgradleæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯AppåŠçš„build.gradleæ–‡ä»¶ã€‚


![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205172155.png)

åœ¨dependencies ä¸­æ·»åŠ ä¸‰ä¸ªimplementationå³å¯ï¼ˆæ³¨æ„ç‰ˆæœ¬å·ï¼‰
![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205173025.png)

ç„¶åå†androidé…ç½®é¡¹æ·»åŠ aaptOptionsï¼ˆå®‰å“èµ„æºæ‰“åŒ…å·¥å…·ï¼‰ï¼Œé…ç½®ä¸ºä¸è¦å‹ç¼©TFLiteæ–‡ä»¶ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ã€‚
![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205173223.png)

é…ç½®å®Œæˆåç‚¹å‡»å³ä¸Šè§’ç«‹å³åŒæ­¥ï¼Œç­‰å¾…å®Œæˆå³å¯ã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205173414.png)

ä¸‹ä¸€æ­¥æ˜¯åˆ‡æ¢ä¸ºå·¥ç¨‹è§†è§’ï¼Œåœ¨app-srcç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªAssets æ–‡ä»¶å¤¹ï¼Œæ¨¡å‹ä¼šæ”¾åˆ°è¿™é‡Œï¼Œç›´æ¥æŠŠæ¨¡å‹pasteè¿›æ¥å°±è¡Œäº†ã€‚ 

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205173759.png)
![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205174049.png)


æœ€åä¸€æ­¥å°±æ¯”è¾ƒå¤æ‚å’Œå…³é”®äº†â€”â€”--ä½¿ç”¨æ¨¡å‹

æ­¥éª¤ï¼šåŠ è½½æ¨¡å‹ã€å®ä¾‹åŒ–è§£é‡Šå™¨ã€è·å–è¾“å…¥æ•°æ®å¹¶æ ¼å¼åŒ–æ¨¡å‹éœ€è¦çš„æ•°æ®ç±»å‹ã€æ„é€ å­˜æ”¾è¾“å‡ºæ•°æ®çš„æ•°æ®ç»“æ„ã€ä½¿ç”¨æ¨¡å‹è¿›è¡Œæ¨ç†ã€è·å–ç»“æœæ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š

**åŠ è½½æ¨¡å‹**
è¿™éƒ¨åˆ†ä»£ç å†™åœ¨app-src-main-javaä¸‹MainActivityæ–‡ä»¶ä¸­

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205175051.png)

åˆ°è¿™é‡Œæ‰å‡ºç°ç¬¬ä¸€ä¸ªéš¾ç‚¹ï¼Œéœ€è¦ç”¨Kotlinå†™ä¸€ä¸ªloadModelFileå‡½æ•°æ¥åŠ è½½æ¨¡å‹

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205175420.png)

**å®ä¾‹åŒ–è§£é‡Šå™¨**
åœ¨MainActivityæ–‡ä»¶ç±»çº§åˆ«åŠ å…¥æ¨¡å‹å’Œè§£é‡Šå™¨çš„å£°æ˜ï¼Œè¿™é‡Œè°ƒç”¨äº†ä¸Šä¸€æ­¥ä¸­çš„loadModelFileå‡½æ•°ï¼ŒæŠŠassetsä¸‹çš„æ¨¡å‹è¯»å…¥åˆ°tflitemodelå¯¹è±¡ï¼Œç„¶åå°†tflitemodelä½œä¸ºå‚æ•°å®ä¾‹åŒ–è§£é‡Šå™¨ï¼Œèµ‹å€¼ç»™è§£é‡Šå™¨å¯¹è±¡tfliteã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205175659.png)

**è·å–è¾“å…¥æ•°æ®å¹¶æ ¼å¼åŒ–æ¨¡å‹éœ€è¦çš„æ•°æ®ç±»å‹**

è¿˜è®°å¾—åŠ è½½TFLiteæ¨¡å‹å¹¶é…ç½®å¼ é‡è¿™ä¸€æ­¥å—ï¼Œæœ‰ä¸€ä¸ªè·å–è¾“å…¥interpreter.get_input_detailesè¯¦ç»†ä¿¡æ¯çš„æ­¥éª¤ã€‚è®°ä¸‹è¾“å…¥è¾“å‡ºä¿¡æ¯çš„shapeå’Œdtype
![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205180237.png)

åœ¨kotlinä¸­ä½¿ç”¨getInputTensorç»“æ„å¯ä»¥å®ç°ç±»ä¼¼çš„æ•ˆæœ

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205180425.png)

ç„¶åå®Œæˆæ•°æ®æ•°æ®çš„æ ¼å¼åŒ–ï¼Œè¿™ä¸€æ­¥ä¹Ÿè¶…çº²äº†ï¼Œéœ€è¦åç»­è¡¥å……ç›¸å…³çŸ¥è¯†æ‰èƒ½ç†è§£ã€‚
![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205180557.png)

**æ„é€ å­˜æ”¾è¾“å‡ºæ•°æ®çš„æ•°æ®ç»“æ„**

å’Œä¸Šé¢ç±»ä¼¼ï¼Œinputæ”¹ä¸ºoutputï¼Œä¸å†é‡å¤ã€‚

**ä½¿ç”¨æ¨¡å‹è¿›è¡Œæ¨ç†**

æ¨¡å‹æ¨ç†ä»£ç å°±ç®€å•äº†ï¼ŒæŠŠè¾“å…¥å’Œè¾“å‡ºæ•°æ®å¯¹è±¡ä½œä¸ºå‚æ•°æ”¾è¿›runæ–¹æ³•å°±è¡Œäº†
![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205180812.png)

**è·å–ç»“æœæ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š**

å°†è·å–åˆ°çš„ByteBufferè½¬åŒ–ä¸ºæµ®ç‚¹å‹æ•°æ®å¼¹çª—æ˜¾ç¤ºï¼Œä¸»è¦å°±æ˜¯å®šä¹‰è¿™ä¸ªå¼¹çª—ã€‚å…¶å®è¿™éƒ¨åˆ†å¯¹åº”ç•Œé¢è®¾è®¡å’Œå®ç°ï¼Œä¹Ÿéœ€è¦åç»­è¡¥å……çŸ¥è¯†æ‰èƒ½ç†è§£ã€‚

![](https://my-wechat.oss-cn-beijing.aliyuncs.com/20221205181107.png)

å®Œæ•´ä»£ç åœ¨ï¼šhttps://github.com/lmoroney/tfbook

åç»­å‡†å¤‡è®¤çœŸå­¦ä¹ ä¸€ä¸‹ï¼Œä¸è¿‡æˆ‘ä¸å¤ªå–œæ¬¢å­¦ä¹ ä¸€å¤§å †åŸºç¡€çŸ¥è¯†ï¼Œå‡†å¤‡å°è¯•å¤åˆ»å¹¶è¿è¡ŒæˆåŠŸä¸€ä¸ªå®˜æ–¹æ¡ˆä¾‹ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šæ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œå…´è¶£é­”æ”¹ä¸€ä¸ªæ–°appï¼Œè¿™æ ·å­¦çš„ä¼šæ›´é€å½»ã€‚

æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·å­¦å•Šã€‚